[tasks.setup]
description = "Create symlinks for dotfiles to home directory"
run = '''
#!/bin/bash
set -e

IGNORE_FILES=".git README.md mise.toml bin nvim ghostty"
BASE_PATH="{{config_root}}"

for file in "$BASE_PATH"/{.*,*}; do
  filename=$(basename "$file")

  # Skip ignored files
  [[ " $IGNORE_FILES " =~ " $filename " ]] && continue
  [[ "$filename" == "." || "$filename" == ".." ]] && continue

  dest="$HOME/$filename"
  ln -sfn "$file" "$dest"
  echo "Linked: $filename -> $dest"
done
'''

[tasks.deno-scripts]
description = "Install deno scripts"
depends = ["install:deno"]
run = '''
#!/bin/bash
set -e
deno install --global --allow-run -n git-modified_files https://deno.land/x/git_modified_files@0.1.4/main.ts
'''

[tasks."install:deno"]
description = "Install deno via mise"
run = "mise install deno"

[tasks."install:ghostty"]
description = "Create ~/.config/ghostty symlink"
run = '''
#!/bin/bash
set -e
mkdir -p "$HOME/.config"
ln -sfn "{{config_root}}/ghostty" "$HOME/.config/ghostty"
echo "Linked: ghostty -> $HOME/.config/ghostty"
'''

[tasks."install:nvim"]
description = "Install neovim via mise and create ~/.config/nvim symlink"
run = '''
#!/bin/bash
set -e
mise install neovim
mkdir -p "$HOME/.config"
ln -sfn "{{config_root}}/nvim" "$HOME/.config/nvim"
echo "Linked: nvim -> $HOME/.config/nvim"
'''

[tasks.vundle]
description = "Install Vundle for vim"
run = '''
#!/bin/bash
set -e
VUNDLE_DIR="$HOME/.vim/bundle/Vundle.vim"
if [ -d "$VUNDLE_DIR" ]; then
  echo "Vundle already installed, updating..."
  cd "$VUNDLE_DIR" && git pull
else
  echo "Installing Vundle..."
  git clone https://github.com/VundleVim/Vundle.vim.git "$VUNDLE_DIR"
fi
echo "Run 'vim +PluginInstall +qall' to install plugins"
'''

[tasks.coc]
description = "Build coc.nvim"
run = '''
#!/bin/bash
set -e
COC_DIR="$HOME/.vim/bundle/coc.nvim"
if [ -d "$COC_DIR" ]; then
  cd "$COC_DIR" && npm ci
  echo "coc.nvim built successfully"
else
  echo "coc.nvim not found. Run 'vim +PluginInstall +qall' first"
  exit 1
fi
'''
